<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragment/head :: common_header(~{::title},~{::link},~{::script})">
    <meta charset="UTF-8">
    <title>Report Management System</title>
    <link rel="stylesheet" type="text/css" th:href="@{/bootstrap/datatable/datatables.min.css}">
    <style type="text/css">
         td,button{
         white-space: nowrap;
         }
    </style>
    <script type="text/javascript" th:src="@{/bootstrap/datatable/datatables.min.js}"></script>
    <script th:inline="javascript">
    $(function(){
    var table =$('#errorLogTable').DataTable({
         "searching":false,
         "aLengthMenu" : [20, 40, 60],
         "bPaginate" : true,
         "bSort" : true,
         "autoWidth":true,
         "bAutoWidth":false,
    });
    })


    function viewOrder(fulfillmentId) {
        openWindow("/order/FulfillmentOrderView?fulfillmentId=" + fulfillmentId);
	}

	function viewProfile(bsn) {
		openWindow("/inv/inventory/InventoryProfileView.action?bsn=" + bsn);
	}

	function clearForm(aform) {
		aform.orderNo.value = "";
		aform.status.value = "0";
		$('.selectpicker').selectpicker('val', '');
		return false;
	}

	function updateActionStatus(logId, actionStatus) {
		document.forms[0].action = "./ErrorLogUpdate.action";
		document.getElementsByName("logId")[0].value = logId;
		document.getElementsByName("actionStatus")[0].value = actionStatus;
		document.forms[0].submit();
	}

	function retryActionStatus(logId) {
		document.forms[0].action = "./ErrorLogRetry.action";
		document.getElementsByName("logId")[0].value = logId;
		document.forms[0].submit();
	}
    </script>
</head>
<body>
<div id="wrapper">
    <div th:replace="fragment/menu :: menu"></div>
    <div id="page-wrapper">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-fw fa-exclamation-circle"></i> Error Log Enquiry
            </div>
            <div class="panel-body">
                <form action="/order/ErrorLogList">
                    <input type="hidden" name="logId"/>
                    <input type="hidden" name="actionStatus"/>
                    <!--<s:hidden name="logId" value="0" />
                    <s:hidden name="actionStatus" value="0" />-->
                    <div class="row">
                        <div class="col-md-2">
                            <select name="errorType" class="selectpicker form-control" data-actions-box="true" data-live-search="true">
                                <option value="0">All Error Types</option>
                                <option th:selected="${errorType eq c.appCd}" th:each="c : ${comm}" th:value="${c.appCd}" th:text="${c.appDesc}"></option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input type="text" name="orderNo" PLACEHOLDER="Fulfillment ID" class="form-control" th:value="${orderNo}"/>
                        </div>
                        <div class="col-md-2">
                            <select name="status" class="selectpicker form-control">
                                <option  th:selected="${status eq 0}" value="0">All Outstanding</option>
                                <option th:selected="${status eq 1}" value="1">New</option>
                                <option th:selected="${status eq 2}" value="2">Acknowledged</option>
                                <option th:selected="${status eq 3}" value="3">Closed</option>
                                <option th:selected="${status eq 9}" value="9">Cancelled</option>
                            </select>
                            <!--<s:select name="status" list="#@java.util.LinkedHashMap@{'0':'All Outstanding', '1':'New', '2':'Acknowledged', '3':'Closed', '9':'Cancelled'}"
                                      class="form-control" />-->
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-primary">
                                <i class="fa fa-search"></i> Search
                            </button>
                            <button class="btn" onclick="return clearForm(this.form);">Clear</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="panel-body">
                <table class="table table-striped table-bordered table-hover" id="errorLogTable" style="width:100%;">
                    <thead>
                    <tr>
                        <th nowrap>Type</th>
                        <th nowrap>Fulfilment ID</th>
                        <th nowrap>Status</th>
                        <th nowrap>Description</th>
                        <th nowrap>Create Date</th>
                        <th nowrap>Last Updated Date</th>
                        <th nowrap>Last Updated By</th>
                        <th nowrap>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:class="${listStat.odd}?'odd':'even'"  th:each="list,listStat:${page}">
                        <td th:text="${list.errorTypeDesc}"></td>
                        <td>
                            <a href="javascript:viewOrder()" th:text="${list.orderNo}"></a>
                        </td>
                        <td>
                            <span th:if="${list.status == 1}"><i class='fa fa-times-circle text-red' aria-hidden='true'></i> New</span>
                            <span th:if="${list.status == 2}"><i class='fa fa-exclamation-triangle text-orange' aria-hidden='true'></i> Ack</span>
                            <span th:if="${list.status == 3}"><i class='fa fa-check-circle text-green' aria-hidden='true'></i>Close</span>
                            <span th:if="${list.status == 9}">Cancel</span>
                        </td>
                        <td th:text="${list.description}"></td>
                        <td th:text="${list.createDate}"></td>
                        <td th:text="${list.lastUpdatedDate}"></td>
                        <td th:text="${list.lastUpdatedBy}"></td>
                        <td>
                            <button class="btn btn-primary" th:onclick="'javascript:updateActionStatus('+${list.logId}+','+${list.status}+')'">Ack</button>

                            <button class="btn btn-success" th:onclick="'javascript:retryActionStatus('+${list.logId}+','+${list.status}+')'">Retry</button>

                            <button class="btn btn-warning" th:onclick="'javascript:updateActionStatus('+${list.logId}+','+${list.status}+')'">Close</button>
                            <button class="btn btn-danger" th:onclick="'javascript:updateActionStatus('+${list.logId}+','+${list.status}+')'">Cancel</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
</body>
</html>